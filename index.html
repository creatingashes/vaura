<html>
<head>
<meta charset="ISO-8859-1">
<title>Vaura</title>
<script
  src="https://code.jquery.com/jquery-3.3.1.min.js"
  integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
  crossorigin="anonymous"></script>
</head>
<body onload="startIt()">
<div id="summary"></div><br/>

<script>
function getUrlParm(parm) {
   var res1 = new URL(window.location.href.replace("#","?"));
   if (res1.searchParams == null) {
      return null;
   } else {
      return res1.searchParams.get(parm);
   }
} 

function dashboardCallback(response){
   if (response.code === "not_authorized") {
      var authUrl = "https://accounts.spotify.com/authorize?client_id=971e22b392a7466b8e359b9622bd850b&response_type=token&redirect_uri=https://rawgit.com/creatingashes/vaura/master/index.html";
      window.location.href = authUrl;
   } else if (getUrlParm('access_token') != null) {
      var para = document.createElement("p");
      var userObj = JSON.parse(response); 
     para.innerHTML = "Name:&nbsp;" + userObj.display_name + "<br/>Email:&nbsp;" + userObj.email;
      document.getElementById("summary").appendChild(para);
   }
}   
   
function requestDashboard() {
    var URL = "https://api.spotify.com/v1/me?access_token=" + getUrlParm('access_token');
    $.get(URL, function( data ) {
      $( "body" )
          .append( "Name: " + data.display_name)
          .append( " Email: " + data.email);
    }, "json" );
}

function startIt() {
   if (getUrlParm('access_token') == null) {
      var authUrl = "https://accounts.spotify.com/authorize?client_id=971e22b392a7466b8e359b9622bd850b&response_type=token&redirect_uri=https://rawgit.com/creatingashes/vaura/master/index.html";
      window.location.href = authUrl;
   } else {
      requestDashboard();
   }
}
</script>
</body>
</html>
